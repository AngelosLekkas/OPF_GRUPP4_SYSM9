@page "/categories"
@rendermode InteractiveServer
@inject NavigationManager Navigation

<PageTitle>Categories</PageTitle>

<h2 class="mb-4 text-center">Choose a Category</h2>

<div class="row g-4">
    @foreach (var category in categories)
    {
        <div class="col-md-3">
            <div class="card shadow-sm border-primary category-card">
                <div class="card-body text-center">
                    <h5 class="card-title fw-bold">@category.Name</h5>
                    <button class="btn btn-primary mt-3 w-75"
                            @onclick="() => ToggleCategory(category.Id)">
                        @if (expandedCategoryId == category.Id)
                        {
                            <span>Collapse</span>
                        }
                        else
                        {
                            <span>Open</span>
                        }
                    </button>
                </div>

                @* Subcategories per category *@
                @if (expandedCategoryId == category.Id)
                {
                    <ul class="list-group list-group-flush border-top mt-2">
                        @foreach (var sub in category.SubCategories)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@sub.Name</strong><br />
                                    <small class="text-muted">@sub.QuestionCount questions</small>
                                </div>
                                @if (sub.IsLocked)
                                {
                                    <span class="text-danger fs-5">🔒</span>
                                }
                                else if (sub.IsCompleted)
                                {
                                    <span class="text-success fs-5">✅</span>
                                }
                                else
                                {
                                    <span class="text-secondary fs-5">⭕</span>
                                }

                                @if (!sub.IsLocked)
                                {
                                    <button class="btn btn-success btn-sm ms-2"
                                            @onclick="() => StartQuiz(sub.Id)">
                                        Start
                                    </button>
                                }
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    }
</div>

@code {
    // Dummy data
    private List<CategoryModel> categories = new()
    {
        new CategoryModel
        {
            Id = 1,
            Name = "Nätverkssäkerhet",
            SubCategories = new List<SubCategoryDto>
            {
                new() { Id = 11, Name = "Sub 1", QuestionCount = 5, IsLocked = false, IsCompleted = true },
                new() { Id = 12, Name = "Sub 2", QuestionCount = 3, IsLocked = true, IsCompleted = false },
                new() { Id = 13, Name = "Sub 3", QuestionCount = 4, IsLocked = false, IsCompleted = false }
            }
        },
        new CategoryModel
        {
            Id = 2,
            Name = "Kryptering",
            SubCategories = new List<SubCategoryDto>
            {
                new() { Id = 21, Name = "Sub 1", QuestionCount = 6, IsLocked = false, IsCompleted = true },
                new() { Id = 22, Name = "Sub 2", QuestionCount = 2, IsLocked = false, IsCompleted = false }
            }
        },
        new CategoryModel
        {
            Id = 3,
            Name = "Webbsäkerhet",
            SubCategories = new List<SubCategoryDto>
            {
                new() { Id = 31, Name = "Sub 1", QuestionCount = 5, IsLocked = true, IsCompleted = false }
            }
        },
        new CategoryModel
        {
            Id = 4,
            Name = "Social Engineering",
            SubCategories = new List<SubCategoryDto>
            {
                new() { Id = 41, Name = "Sub 1", QuestionCount = 4, IsLocked = false, IsCompleted = false },
                new() { Id = 42, Name = "Sub 2", QuestionCount = 5, IsLocked = false, IsCompleted = true }
            }
        }
    };

    // Håller vilka kategorier som är expanderade
    private int? expandedCategoryId = null;

    private void ToggleCategory(int categoryId)
    {
        if (expandedCategoryId == categoryId)
            expandedCategoryId = null; // stäng om samma klickas
        else
            expandedCategoryId = categoryId; // öppna ny
    }

    private void StartQuiz(int subCategoryId)
    {
        Navigation.NavigateTo($"/questions/{subCategoryId}");
    }

    // Dummy-modeller
    private class CategoryModel
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public List<SubCategoryDto> SubCategories { get; set; } = new();
    }

    private class SubCategoryDto
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public int QuestionCount { get; set; }
        public bool IsLocked { get; set; }
        public bool IsCompleted { get; set; }
    }
}